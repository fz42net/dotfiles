# 1) Defaults
- defaults:
    link:
      create: true
      relink: true    # <â€“ overwrite existing files
      force: true     # <â€“ remove non-symlinks first
      
# 2) Enforce home structure
- shell:
  - mkdir -p "$HOME/bin" "$HOME/assets" "$HOME/src/github.com" "$HOME/tmp"

# 3) Core links
- link:
    ~/.config/ghostty: link/ghostty
    ~/.config/nvim: link/nvim
    ~/.gitconfig: git/gitconfig.base
    ~/.config/tmux: link/tmux
    ~/.zsh: link/zsh
    ~/.zshrc: link/zshrc

# 5) Post linking
- shell:
  - [ "echo", "[public] common installed" ]
  - [git submodule update --init --recursive, Installing submodules]
  - [~/.tmux/plugins/tpm/bin/install_plugins, Installing tmux TPM plugins]

  # Install apt packages if on Linux
- if:
  - cond: '[[ "$(uname)" == "Linux" ]]'
    met:
      - shell:
        - description: sudo apt install the packages we want
          command: |
            sudo apt update
            sudo apt install -y $(cat apt_packages.txt)

# Install homebrew packages and pip's argcomplete if on macOS
- if:
    cond: '[[ "$(uname)" == "Darwin" ]]'
    met:
    - shell:
      - brew bundle install --file=brew/Brewfile.base
    - shell:
      - command: pip3 install argcomplete #--break-system-packages
    - shell:
      - command: source osx.sh
